---
version: '1'
messages:
  $i18n: locales.yml
welcome:
  description: 'With this toolchain, you can develop and deploy an application securely into a Kubernetes cluster managed by the IBM Cloud Kubernetes Service. By default, the toolchain uses a sample Node.js \"Hello World\" app, but you can also bring your own app and link to it instead.'
steps:
  - name: app
    label: Application
    form: 
      name: wizard_app
      title: Application
    validator: repo
    expert_mode:
      service_label: repo
    events:
      - condition:
          any:
            - parameter: source_provider
              value: hostedgit
        actions:
          - type: replace-service
            service: hostedgit
            service_label: repo
            parameters:
              repo_name: "hello-containers-{{timestamp}}"
              repo_url: 'https://github.com/open-toolchain/brian-containers'
              source_repo_url: 'https://github.com/open-toolchain/brian-containers'
              type: 'clone'
              has_issues: true
              enable_traceability: true
              legal: true
              source_provider: hostedgit
      - condition:
          any:
            - parameter: source_provider
              value: githubconsolidated
        actions:
          - type: replace-service
            service: githubconsolidated
            service_label: repo
            parameters:
              repo_name: "hello-containers-{{timestamp}}"
              repo_url: 'https://github.com/open-toolchain/hello-containers'
              source_repo_url: 'https://github.com/open-toolchain/hello-containers'
              type: 'clone'
              has_issues: true
              enable_traceability: true
              legal: true
              source_provider: githubconsolidated
      - condition:
          any:
            - parameter: source_provider
              value: gitlab
        actions:
          - type: replace-service
            service: gitlab
            service_label: repo
            parameters:
              repo_name: "hello-containers-{{timestamp}}"
              repo_url: 'https://github.com/open-toolchain/hello-containers'
              source_repo_url: 'https://github.com/open-toolchain/hello-containers'
              type: 'clone'
              has_issues: true
              enable_traceability: true
              legal: true
              source_provider: gitlab
      - condition:
          any:
            - parameter: source_provider
              value: bitbucketgit
        actions:
          - type: replace-service
            service: bitbucketgit
            service_label: repo
            parameters:
              repo_name: "hello-containers-{{timestamp}}"
              repo_url: 'https://github.com/open-toolchain/hello-containers'
              source_repo_url: 'https://github.com/open-toolchain/hello-containers'
              type: 'clone'
              has_issues: true
              enable_traceability: true
              legal: true
              source_provider: bitbucketgit
      - condition:
          any:
            - parameter: source_provider
              value: github_integrated
        actions:
          - type: replace-service
            service: github_integrated
            service_label: repo
            parameters:
              repo_name: "hello-containers-{{timestamp}}"
              repo_url: 'https://github.com/open-toolchain/hello-containers'
              source_repo_url: 'https://github.com/open-toolchain/hello-containers'
              type: 'clone'
              has_issues: true
              enable_traceability: true
              legal: true
              source_provider: github_integrated
  - name: vault
    label: Secrets Management
    form: 
      name: wizard_vault
      title: Secrets Management
    events:
      - condition:
          any:
            - parameter: key-protect
              value: true
        actions:
          - type: create-service
            service: keyprotect
            service_label: kp-vault
            parameters:
              name: kp-compliance-secrets
      - condition:
          any:
            - parameter: key-protect
              value: false
        actions:
          - type: delete-service
            service: keyprotect
            service_label: kp-vault
      - condition:
          any:
            - parameter: secrets-manager
              value: true
        actions:
          - type: create-service
            service: secretsmanager
            service_label: sm-vault
            parameters:
              name: sm-compliance-secrets
      - condition:
          any:
            - parameter: secrets-manager
              value: false
        actions:
          - type: delete-service
            service: secretsmanager
            service_label: sm-vault
      - condition:
          any:
            - parameter: hashicorp-vault
              value: true
        actions:
          - type: create-service
            service: hashicorpvault
            service_label: hc-vault
            parameters:
              name: 'hc-compliance-secrets'
              server_url: 'https://vserv.sos.ibm.com:8200'
              dashboard_url: 'https://vserv.sos.ibm.com:8200/ui'
              authentication_method: 'approle'
      - condition:
          any:
            - parameter: hashicorp-vault
              value: false
        actions:
          - type: delete-service
            service: hashicorpvault
            service_label: hc-vault
  - name: keyprotect
    indent_level: 1
    label: Key Protect
    form: 
      name: keyprotect
      title: Key Protect
    validator: kp-vault
    visible:
      condition:
        any:
          - form: wizard_vault
            parameter: key-protect
            value: true
  - name: secretsmanager
    indent_level: 1
    label: Secrets Manager
    form: 
      name: secretsmanager
      title: Secrets Manager
    validator: sm-vault
    visible:
      condition:
        any:
          - form: wizard_vault
            parameter: secrets-manager
            value: true
  - name: hashicorpvault
    indent_level: 1
    label: HashiCorp Vault
    form: 
      name: hashicorpvault
      title: HashiCorp Vault
    validator: hc-vault
    visible:
      condition:
        any:
          - form: wizard_vault
            parameter: hashicorp-vault
            value: true
  - name: deploy
    label: Deploy
    form: 
      name: pipeline
      title: Deployment Target
  - name: othertools
    label: Other Tools
    form: 
      name: wizard_other_tools
      title: Optional Tools
    events:
      - condition:
          any:
            - parameter: webide
              value: true
        actions:
          - type: create-service
            service: orion
            service_label: webide
      - condition:
          any:
            - parameter: webide
              value: false
        actions:
          - type: delete-service
            service: orion
            service_label: webide
  - name: summary
    label: Summary
    form: 
      name: wizard_summary
      title: Summary
