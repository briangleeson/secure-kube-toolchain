---
version: '1'
messages:
  $i18n: locales.yml
welcome:
  description: 
      $ref: "#/messages/wizard.welcome.description"
  source_provider:
    show_global: false
steps:
  - name: app
    title:
      $ref: "#/messages/wizard.step.application.title"
    form: wizard_app
    advanced_form: repo
    conditions:
      - condition:
          any:
            - parameter: source_provider
              value: hostedgit
        actions:
          - type: update-service
            service_id: hostedgit
            service_label: repo
            parameters:
              source_provider: hostedgit
            keep_parameters:
              - repo_name
              - repo_url
              - source_repo_url
              - type
              - has_issues
              - enable_traceability
              - legal
          - type: update-service-parameters
            service_id: pipeline
            service_label: pr
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'gitlab-pr-listener'
          - type: update-service-parameters
            service_id: pipeline
            service_label: build
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'grit-or-gitlab-commit'
      - condition:
          any:
            - parameter: source_provider
              value: githubconsolidated
        actions:
          - type: update-service
            service_id: githubconsolidated
            service_label: repo
            parameters:
              source_provider: githubconsolidated
            keep_parameters:
              - repo_name
              - repo_url
              - source_repo_url
              - type
              - has_issues
              - enable_traceability
              - legal
          - type: update-service-parameters
            service_id: pipeline
            service_label: pr
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'github-pr-listener'
          - type: update-service-parameters
            service_id: pipeline
            service_label: build
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'github-commit'
      - condition:
          any:
            - parameter: source_provider
              value: gitlab
        actions:
          - type: update-service
            service_id: gitlab
            service_label: repo
            parameters:
              source_provider: gitlab
            keep_parameters:
              - repo_name
              - repo_url
              - source_repo_url
              - type
              - has_issues
              - enable_traceability
              - legal
          - type: update-service-parameters
            service_id: pipeline
            service_label: pr
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'gitlab-pr-listener'
          - type: update-service-parameters
            service_id: pipeline
            service_label: build
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'grit-or-gitlab-commit'
      - condition:
          any:
            - parameter: source_provider
              value: bitbucketgit
        actions:
          - type: update-service
            service_id: bitbucketgit
            service_label: repo
            parameters:
              source_provider: bitbucketgit
            keep_parameters:
              - repo_name
              - repo_url
              - source_repo_url
              - type
              - has_issues
              - enable_traceability
              - legal
          - type: update-service-parameters
            service_id: pipeline
            service_label: pr
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'bitbucket-commit'
          - type: update-service-parameters
            service_id: pipeline
            service_label: build
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'bitbucket-commit'
      - condition:
          any:
            - parameter: source_provider
              value: github_integrated
        actions:
          - type: update-service
            service_id: github_integrated
            service_label: repo
            parameters:
              source_provider: github_integrated
            keep_parameters:
              - repo_name
              - repo_url
              - source_repo_url
              - type
              - has_issues
              - enable_traceability
              - legal
          - type: update-service-parameters
            service_id: pipeline
            service_label: pr
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'github-ent-pr-listener'
          - type: update-service-parameters
            service_id: pipeline
            service_label: build
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'github-ent-commit'
      - condition:
          any:
            - parameter: source_provider
              value: hostedgit
        actions:
          - type: update-service
            service_id: hostedgit
            service_label: repo
            parameters:
              source_provider: hostedgit
            keep_parameters:
              - repo_name
              - repo_url
              - source_repo_url
              - type
              - has_issues
              - enable_traceability
              - legal
          - type: update-service-parameters
            service_id: pipeline
            service_label: pr
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'gitlab-pr-listener'
          - type: update-service-parameters
            service_id: pipeline
            service_label: build
            parameters:
              configuration:
                env:
                  GIT_COMMIT_EVENT_LISTENER_NAME: 'grit-or-gitlab-commit'
  - name: app2
    title: "Tilegroup Test"
    form: wizard_app2
  - name: vault
    title:
      $ref: "#/messages/wizard.step.vault.title"
    form: wizard_vault
    conditions:
      $ref: conditions.yml#/vault_conditions
  - name: keyprotect
    indent_level: 1
    title:
      $ref: "#/messages/wizard.step.keyprotect.title"
    form: keyprotect
    visible:
      condition:
        any:
          - form: wizard_vault
            parameter: key-protect
            value: true
  - name: hashicorpvault
    indent_level: 1
    title:
      $ref: "#/messages/wizard.step.hashicorpvault.title"
    form: hashicorpvault
    visible:
      condition:
        any:
          - form: wizard_vault
            parameter: hashicorp-vault
            value: true
  - name: deploy
    label: 
      $ref: "#/messages/wizard.step.deploy.label"
    title:
      $ref: "#/messages/wizard.step.deploy.title"
    form: pipeline
  - name: optionaltools
    title:
      $ref: "#/messages/wizard.step.optionaltools.title"
    form: wizard_optional_tools
    conditions:
      $ref: conditions.yml#/tools_conditions
  - name: summary
    title:
      $ref: "#/messages/wizard.step.summary.title"
    form: wizard_summary

form:
  wizard_app:
    schema:
      $ref: wizard_app.json

  wizard_vault:
    parameters:
      key-protect: false
      hashicorp-vault: false
    schema:
      $ref: wizard_vault.json

  wizard_optional_tools:
    parameters:
      webide: true
      doi: true
    schema:
      $ref: wizard_optional_tools.json

  wizard_summary:
    schema:
      $ref: wizard_summary.json
